{"ast":null,"code":"var _jsxFileName = \"E:\\\\SYGEFEX\\\\Sygefex-front-Formik\\\\src\\\\components\\\\town\\\\CreateTownHook.jsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport { useMutation, useQuery } from '@apollo/react-hooks';\nimport { MinimStyledPage } from '../styles/StyledPage';\nimport Error from '../ErrorMessage.js';\nimport Select from 'react-select';\nimport useForm from '../utils/useForm';\nimport { Formik, Form } from 'formik';\nimport { SygexInput, StyledForm, ButtonStyled, StyledButton, customStyle } from '../utils/FormInputs';\nimport styled from 'styled-components';\nimport * as Yup from 'yup';\nimport { createTownMutation } from '../queries&Mutations&Functions/Mutations';\nimport { removeTypename, getObjectFromID } from '../queries&Mutations&Functions/Functions';\nimport { getAllCountrysQuery, getDivisionsOfARegionQuery, getAllRegionsOfACountryQuery, getSubDivisionsOfADivisionQuery } from '../queries&Mutations&Functions/Queries';\nconst InputGroup = styled.div.withConfig({\n  displayName: \"CreateTownHook__InputGroup\",\n  componentId: \"sc-1po89zj-0\"\n})([\"display:flex;flex-direction:column;min-width:13rem;margin:0 1rem;\"]);\nconst AllControls = styled.div.withConfig({\n  displayName: \"CreateTownHook__AllControls\",\n  componentId: \"sc-1po89zj-1\"\n})([\"display:flex;flex-direction:column;\"]);\nconst validationSchema = Yup.object().shape({\n  subDiv: Yup.string().required(\"Choix Du type d'Enseignement Obligatoire\"),\n  townName: Yup.string().required(\"Choix de la matière Obligatoire\"),\n  townCode: Yup.string().required(\"Choix de la Séries Obligatoire\")\n});\n\nconst CreateTownHook = () => {\n  const initialValues = {\n    townName: \"\",\n    townCode: \"\",\n    subDiv: \"\"\n  };\n  const [state, setState, handleReactSelectChange] = useForm({\n    regionID: \"\",\n    divisionID: \"\"\n  });\n  const {\n    data,\n    loading: loadingCount,\n    error: errorCount\n  } = useQuery(getAllCountrysQuery);\n  {\n    loadingCount && __jsx(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 23\n      }\n    }, \"Loading Countries from DB...\");\n  }\n  {\n    errorCount && __jsx(Error, {\n      error: error,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 21\n      }\n    });\n  }\n\n  const {\n    countries\n  } = _objectSpread({}, data);\n\n  console.log(countries);\n  const reducedCountries = countries && countries.reduce(item => item);\n  console.log(reducedCountries);\n\n  const {\n    id\n  } = _objectSpread({}, reducedCountries);\n\n  console.log(id);\n  const {\n    data: dataCountry,\n    loading: loadingCountry,\n    error: errCountry\n  } = useQuery(getAllRegionsOfACountryQuery, {\n    variables: {\n      id: id\n    }\n  });\n  {\n    loadingCountry && __jsx(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 25\n      }\n    }, \"loading...\");\n  }\n  {\n    errCountry && __jsx(Error, {\n      error: errCountry,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 21\n      }\n    });\n  }\n  console.log(dataCountry);\n  const getCountry = dataCountry && dataCountry.country;\n  console.log(getCountry);\n\n  const {\n    region\n  } = _objectSpread({}, getCountry);\n\n  const getRegionsOptions = region && region.map(item => ({\n    value: item.id,\n    label: item.regName\n  }));\n  console.log(state.regionID);\n  const {\n    data: dataRegion,\n    loading: loadingRegion,\n    error: errRegion\n  } = useQuery(getDivisionsOfARegionQuery, {\n    skip: !state.regionID,\n    variables: {\n      id: state.regionID\n    }\n  });\n  {\n    loadingRegion && __jsx(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 24\n      }\n    }, \"loading...\");\n  }\n  {\n    errRegion && __jsx(Error, {\n      error: errRegion,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 20\n      }\n    });\n  }\n  console.log(dataRegion);\n  const getRegion = dataRegion && dataRegion.region;\n\n  const {\n    division\n  } = _objectSpread({}, getRegion);\n\n  console.log(division);\n  const getDivOptions = division && division.map(item => ({\n    value: item.id,\n    label: item.divName\n  }));\n  console.log(state.divisionID);\n  const {\n    data: dataDivision,\n    loading: loadingDivision,\n    error: errDivision\n  } = useQuery(getSubDivisionsOfADivisionQuery, {\n    skip: !state.divisionID,\n    variables: {\n      id: state.divisionID\n    }\n  });\n  {\n    loadingDivision && __jsx(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 26\n      }\n    }, \"loading...\");\n  }\n  {\n    errDivision && __jsx(Error, {\n      error: errDivision,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 22\n      }\n    });\n  }\n  console.log(dataDivision);\n  const getDivision = dataDivision && dataDivision.division;\n\n  const {\n    subDivision\n  } = _objectSpread({}, getDivision);\n\n  console.log(subDivision);\n  const getSubDivOptions = subDivision && subDivision.map(item => ({\n    value: item.id,\n    label: item.subDivName\n  }));\n  const [createTown, {\n    loading,\n    error\n  }] = useMutation(createTownMutation);\n  return __jsx(Formik, {\n    method: \"POST\",\n    initialValues: initialValues,\n    validationSchema: validationSchema,\n    onSubmit: async (values, actions, setSubmitting, resetForm) => {\n      const res = await createTown({\n        variables: _objectSpread(_objectSpread({}, values), {}, {\n          subDiv: values.subDiv && getObjectFromID(values.subDiv.value)\n        })\n      });\n      setTimeout(() => {\n        console.log(JSON.stringify(values, null, 2));\n        console.log(res);\n        actions.resetForm(true);\n        actions.setSubmitting(false);\n      }, 400);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 9\n    }\n  }, ({\n    values,\n    setFieldValue,\n    isSubmitting\n  }) => {\n    return __jsx(MinimStyledPage, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 21\n      }\n    }, __jsx(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 25\n      }\n    }, \"Nouvelle Ville\"), __jsx(Error, {\n      error: error,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 25\n      }\n    }), __jsx(StyledForm, {\n      disabled: isSubmitting,\n      \"aria-busy\": isSubmitting,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 25\n      }\n    }, __jsx(Form, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 29\n      }\n    }, __jsx(AllControls, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 33\n      }\n    }, __jsx(InputGroup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 37\n      }\n    }, __jsx(Select, {\n      onChange: handleReactSelectChange,\n      name: \"regionID\",\n      styles: customStyle,\n      placeholder: \"La Région\",\n      options: getRegionsOptions,\n      disabled: isSubmitting,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 41\n      }\n    }), __jsx(Select, {\n      onChange: handleReactSelectChange,\n      name: \"divisionID\",\n      styles: customStyle,\n      placeholder: \"Le Département\",\n      options: getDivOptions,\n      disabled: isSubmitting,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 41\n      }\n    }), __jsx(Select, {\n      onChange: value => setFieldValue('subDiv', value),\n      name: \"subDiv\",\n      styles: customStyle,\n      placeholder: \"L'Arrondissement\",\n      options: getSubDivOptions,\n      disabled: isSubmitting,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 41\n      }\n    }), __jsx(SygexInput, {\n      name: \"townName\",\n      type: \"text\",\n      label: \"Lib\\xE9ll\\xE9 de la ville\",\n      disabled: isSubmitting,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 41\n      }\n    }), __jsx(SygexInput, {\n      name: \"townCode\",\n      type: \"text\",\n      label: \"Code de la ville\",\n      disabled: isSubmitting,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 41\n      }\n    })), __jsx(ButtonStyled, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 37\n      }\n    }, __jsx(StyledButton, {\n      type: \"submit\",\n      disabled: isSubmitting,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 41\n      }\n    }, \"Valid\", isSubmitting ? 'ation en cours' : 'er'))))));\n  });\n};\n\nexport default CreateTownHook;","map":{"version":3,"sources":["E:/SYGEFEX/Sygefex-front-Formik/src/components/town/CreateTownHook.jsx"],"names":["React","useMutation","useQuery","MinimStyledPage","Error","Select","useForm","Formik","Form","SygexInput","StyledForm","ButtonStyled","StyledButton","customStyle","styled","Yup","createTownMutation","removeTypename","getObjectFromID","getAllCountrysQuery","getDivisionsOfARegionQuery","getAllRegionsOfACountryQuery","getSubDivisionsOfADivisionQuery","InputGroup","div","AllControls","validationSchema","object","shape","subDiv","string","required","townName","townCode","CreateTownHook","initialValues","state","setState","handleReactSelectChange","regionID","divisionID","data","loading","loadingCount","error","errorCount","countries","console","log","reducedCountries","reduce","item","id","dataCountry","loadingCountry","errCountry","variables","getCountry","country","region","getRegionsOptions","map","value","label","regName","dataRegion","loadingRegion","errRegion","skip","getRegion","division","getDivOptions","divName","dataDivision","loadingDivision","errDivision","getDivision","subDivision","getSubDivOptions","subDivName","createTown","values","actions","setSubmitting","resetForm","res","setTimeout","JSON","stringify","setFieldValue","isSubmitting"],"mappings":"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","sourcesContent":["\r\nimport React from 'react';\r\nimport { useMutation, useQuery } from '@apollo/react-hooks'\r\nimport { MinimStyledPage } from '../styles/StyledPage'\r\nimport Error from '../ErrorMessage.js';\r\nimport Select from 'react-select'\r\nimport useForm from '../utils/useForm'\r\nimport { Formik, Form } from 'formik';\r\nimport { SygexInput, StyledForm, ButtonStyled, StyledButton, customStyle } from '../utils/FormInputs'\r\nimport styled from 'styled-components';\r\nimport * as Yup from 'yup';\r\nimport { createTownMutation } from '../queries&Mutations&Functions/Mutations'\r\nimport { removeTypename, getObjectFromID } from '../queries&Mutations&Functions/Functions'\r\nimport {\r\n    getAllCountrysQuery,\r\n    getDivisionsOfARegionQuery,\r\n    getAllRegionsOfACountryQuery,\r\n    getSubDivisionsOfADivisionQuery\r\n} from '../queries&Mutations&Functions/Queries'\r\n\r\nconst InputGroup = styled.div`\r\n    \r\n    display: flex;\r\n    flex-direction:column;\r\n    min-width:13rem;\r\n    margin:0 1rem;\r\n   \r\n`;\r\nconst AllControls = styled.div`\r\n  display: flex;\r\nflex-direction:column;\r\n/* min-width: 17rem; */\r\n`;\r\n\r\nconst validationSchema = Yup\r\n    .object()\r\n    .shape({\r\n        subDiv: Yup\r\n            .string()\r\n            .required(\"Choix Du type d'Enseignement Obligatoire\"),\r\n        townName: Yup\r\n            .string()\r\n            .required(\"Choix de la matière Obligatoire\"),\r\n        townCode: Yup\r\n            .string()\r\n            .required(\"Choix de la Séries Obligatoire\"),\r\n    });\r\n\r\nconst CreateTownHook = () => {\r\n    const initialValues = {\r\n        townName: \"\",\r\n        townCode: \"\",\r\n        subDiv: \"\"\r\n    }\r\n    const [state, setState, handleReactSelectChange] = useForm({ regionID: \"\", divisionID: \"\" })\r\n\r\n    const { data, loading: loadingCount, error: errorCount } = useQuery(getAllCountrysQuery)\r\n    { loadingCount && <p>Loading Countries from DB...</p> }\r\n    { errorCount && <Error error={error} /> }\r\n    const { countries } = { ...data }\r\n    console.log(countries);\r\n    const reducedCountries = countries && countries.reduce((item) => item)\r\n    console.log(reducedCountries);\r\n    const { id } = { ...reducedCountries }\r\n    console.log(id);\r\n\r\n\r\n    const { data: dataCountry, loading: loadingCountry, error: errCountry } = useQuery(getAllRegionsOfACountryQuery, {\r\n        variables: { id: id }\r\n    })\r\n    { loadingCountry && <p>loading...</p>; }\r\n    { errCountry && <Error error={errCountry} />; }\r\n    console.log(dataCountry);\r\n    const getCountry = dataCountry && dataCountry.country;\r\n    console.log(getCountry);\r\n    const { region } = { ...getCountry }\r\n    const getRegionsOptions =\r\n        region &&\r\n        region.map(item => ({ value: item.id, label: item.regName }));\r\n    console.log(state.regionID);\r\n\r\n    const { data: dataRegion, loading: loadingRegion, error: errRegion } = useQuery(getDivisionsOfARegionQuery, {\r\n        skip: !state.regionID,\r\n        variables: { id: state.regionID }\r\n    })\r\n    { loadingRegion && <p>loading...</p>; }\r\n    { errRegion && <Error error={errRegion} />; }\r\n    console.log(dataRegion);\r\n    const getRegion = dataRegion && dataRegion.region\r\n    const { division } = { ...getRegion }\r\n    console.log(division);\r\n    const getDivOptions = division && division.map(item => ({ value: item.id, label: item.divName }))\r\n\r\n    console.log(state.divisionID);\r\n\r\n    const { data: dataDivision, loading: loadingDivision, error: errDivision } = useQuery(getSubDivisionsOfADivisionQuery, {\r\n        skip: !state.divisionID,\r\n        variables: { id: state.divisionID }\r\n    })\r\n    { loadingDivision && <p>loading...</p>; }\r\n    { errDivision && <Error error={errDivision} />; }\r\n    console.log(dataDivision);\r\n    const getDivision = dataDivision && dataDivision.division\r\n    const { subDivision } = { ...getDivision }\r\n    console.log(subDivision);\r\n    const getSubDivOptions = subDivision && subDivision.map(item => ({ value: item.id, label: item.subDivName }))\r\n\r\n\r\n    const [createTown, { loading, error }] = useMutation(createTownMutation)\r\n    return (\r\n        <Formik\r\n            method=\"POST\"\r\n            initialValues={initialValues}\r\n            validationSchema={validationSchema}\r\n            onSubmit={async (values, actions, setSubmitting, resetForm) => {\r\n                const res = await createTown({\r\n                    variables: {\r\n                        ...values,\r\n                        subDiv: values.subDiv && getObjectFromID(values.subDiv.value)\r\n                    }\r\n                });\r\n                setTimeout(() => {\r\n                    console.log(JSON.stringify(values, null, 2));\r\n                    console.log(res);\r\n                    actions.resetForm(true);\r\n                    actions.setSubmitting(false);\r\n                }, 400);\r\n            }}>\r\n            {({ values, setFieldValue, isSubmitting }) => {\r\n                return (\r\n                    <MinimStyledPage>\r\n                        <h4>Nouvelle Ville</h4>\r\n                        <Error error={error} />\r\n                        <StyledForm disabled={isSubmitting} aria-busy={isSubmitting} >\r\n                            <Form>\r\n                                <AllControls>\r\n                                    <InputGroup>\r\n                                        <Select onChange={handleReactSelectChange} name=\"regionID\" styles={customStyle} placeholder={\"La Région\"} options={getRegionsOptions} disabled={isSubmitting} />\r\n                                        <Select onChange={handleReactSelectChange} name=\"divisionID\" styles={customStyle} placeholder={\"Le Département\"} options={getDivOptions} disabled={isSubmitting} />\r\n                                        <Select onChange={(value) => (setFieldValue('subDiv', value))} name=\"subDiv\" styles={customStyle} placeholder=\"L'Arrondissement\" options={getSubDivOptions} disabled={isSubmitting} />\r\n                                        <SygexInput name=\"townName\" type=\"text\" label=\"Libéllé de la ville\" disabled={isSubmitting} />\r\n                                        <SygexInput name=\"townCode\" type=\"text\" label=\"Code de la ville\" disabled={isSubmitting} />\r\n                                    </InputGroup>\r\n                                    <ButtonStyled>\r\n                                        <StyledButton type=\"submit\" disabled={isSubmitting}>Valid{isSubmitting ? 'ation en cours' : 'er'}</StyledButton>\r\n                                    </ButtonStyled>\r\n                                </AllControls>\r\n                            </Form>\r\n                        </StyledForm>\r\n                    </MinimStyledPage>\r\n                )\r\n            }}\r\n        </Formik>\r\n\r\n    );\r\n}\r\nexport default CreateTownHook;"]},"metadata":{},"sourceType":"module"}