{"version":3,"file":"static/webpack/static\\development\\pages\\creates\\newRegister.js.55e2fb179061b6d75e62.hot-update.js","sources":["webpack:///./src/components/registration/RecentRegistration.jsx"],"sourcesContent":["import React, { Component } from 'react';\r\nimport { Mutation, Query } from 'react-apollo';\r\nimport Form from '../styles/Form';\r\nimport { MiniStyledPage } from '../styles/StyledPage';\r\nimport Error from '../ErrorMessage';\r\nimport styled from 'styled-components';\r\nimport Router from 'next/router'\r\nimport { getSelectedObject, uniqueCodeGen, pad, candExamSessionCode } from '../queries&Mutations&Functions/Functions';\r\nimport { createRegistrationMutation } from '../queries&Mutations&Functions/Mutations';\r\nimport {\r\n    getExamSessionQuery,\r\n    getRegisteredCandidateCountQuery,\r\n    getAllExamsQuery,\r\n    getAllSessionsQuery,\r\n    getSingleCenterExamSessionQuery,\r\n    getAllSeriesOfACenterExamSessionQuery,\r\n    getCenterExamSessionSeriesQuery,\r\n    getSingleCenterQuery\r\n} from '../queries&Mutations&Functions/Queries';\r\n\r\nconst StyledDivision = styled.div`\r\n\tdisplay: grid;\r\n\tgrid-template-columns: 1fr;\r\n\ttext-align: center;\r\n\tmargin: 0 auto;\r\n    .submitButton{\r\npaddding-top:2rem;\r\n    }\r\n`;\r\n\r\n\r\nconst OtherSelect = styled.div`\r\n\tdisplay: block;\r\n\ttext-align: center;\r\n\tmargin: 0 auto;\r\n`;\r\n\r\nclass RecentRegistration extends Component {\r\n    state = {\r\n        examID: \"\",\r\n        sessionID: \"\",\r\n        centerNumber: \"\",\r\n        candCode: \"\",\r\n        seriesID: \"\",\r\n    };\r\n\r\n    handleChange = (e) => {\r\n        const { name, value, type } = e.target;\r\n        const val = type === 'number' ? parseInt(value) : value;\r\n        this.setState({ [name]: val });\r\n    };\r\n\r\n    resetForm = () => {\r\n        this.setState({ candCode: '' });\r\n    };\r\n\r\n    makeCenterVariableObject = (centerCodeValue) => {\r\n        const storedCenter = {\r\n            centerNumber: `${centerCodeValue}`\r\n        };\r\n        return storedCenter;\r\n    };\r\n\r\n    candRegistrationNumber = (centerCode, exam, session, serialCode) => {\r\n\r\n        return `${centerCode + exam + session + serialCode}`\r\n\r\n    };\r\n    makeCandVariableObject = (candCodeValue) => {\r\n        const storedCandidate = {\r\n            candCode: `${candCodeValue}`\r\n        };\r\n        return storedCandidate;\r\n    };\r\n    makeCESSObject = (candCodeValue) => {\r\n        const objCESS = {\r\n            id: `${candCodeValue}`\r\n        };\r\n        return objCESS;\r\n    };\r\n\r\n    render() {\r\n        const {\r\n            candCode,\r\n            seriesID,\r\n            examID,\r\n            sessionID,\r\n            centerNumber\r\n        } = this.state;\r\n        return (\r\n            <Query query={getAllExamsQuery}>\r\n                {({ data, loading, error }) => {\r\n                    {\r\n                        loading && <p>loading...</p>;\r\n                    }\r\n                    {\r\n                        error && <Error error={error} />;\r\n                    }\r\n\r\n                    const { exams } = data;\r\n                    console.log(exams);\r\n                    const getExamName = exams && { ...getSelectedObject(exams, examID) }\r\n                    const refinedExams = exams && exams.map(({\r\n                        __typename,\r\n                        examName,\r\n                        ...others\r\n                    }) => others);\r\n\r\n                    return (\r\n                        <Query query={getAllSessionsQuery}>\r\n                            {({ data, loading, error }) => {\r\n                                {\r\n                                    loading && (\r\n                                        <p >\r\n                                            loading...\r\n                                        </p>\r\n                                    );\r\n                                }\r\n                                {\r\n                                    error && (<Error error={error} />);\r\n                                }\r\n\r\n                                const { sessions } = data;\r\n                                console.log(sessions);\r\n                                const getSessionName = sessions && { ...getSelectedObject(sessions, sessionID) }\r\n                                const refinedSessions = sessions && sessions.map(({\r\n                                    __typename,\r\n                                    sessionName,\r\n                                    ...others\r\n                                }) => others);\r\n\r\n                                return (\r\n\r\n                                    <Query query={getExamSessionQuery}\r\n                                        variables={{\r\n\r\n                                            exam: refinedExams && getSelectedObject(refinedExams, examID),\r\n                                            session: refinedSessions && getSelectedObject(refinedSessions, sessionID)\r\n                                        }}  >\r\n                                        {({ data, error, loading }) => {\r\n                                            console.log(data)\r\n                                            const { examSessions } = { ...data }\r\n                                            const refinedES = examSessions && examSessions.map(({ __typename, ...others }) => others)\r\n                                            const reducedES = refinedES && refinedES.reduce((item) => item)\r\n                                            console.log(reducedES)\r\n\r\n                                            return (\r\n                                                <Query query={getSingleCenterQuery}\r\n                                                    variables={{ centerNumber: centerNumber, }}  >\r\n                                                    {({ data, error, loading }) => {\r\n                                                        { loading && <p>...Loading</p> }\r\n                                                        { error && <Error error={error} /> }\r\n                                                        const { centerByNumber } = { ...data }\r\n                                                        centerByNumber && delete centerByNumber.__typename\r\n                                                        console.log(centerByNumber)\r\n                                                        return (\r\n                                                            <Query\r\n                                                                query={getSingleCenterExamSessionQuery}\r\n                                                                variables={{\r\n                                                                    examSession: reducedES && reducedES,\r\n                                                                    center: centerByNumber && centerByNumber\r\n                                                                }}>\r\n                                                                {({ data, error, loading }) => {\r\n                                                                    { loading && <p>...Loading</p> }\r\n                                                                    { error && <Error error={error} /> }\r\n                                                                    console.log(data);\r\n                                                                    const { centerExamSessions } = {\r\n                                                                        ...data\r\n                                                                    };\r\n                                                                    console.log(centerExamSessions);\r\n                                                                    // remove typename from the object\r\n                                                                    const refinedCenterExamSessions = centerExamSessions && centerExamSessions.map(({\r\n                                                                        __typename,\r\n                                                                        ...others\r\n                                                                    }) => others);\r\n                                                                    // transform the array into a single object\r\n                                                                    const getObj = refinedCenterExamSessions && refinedCenterExamSessions.reduce((item) => item);\r\n                                                                    console.log(getObj);\r\n                                                                    return (\r\n                                                                        <Query query={getRegisteredCandidateCountQuery} variables={{ id: getObj.id }}  >\r\n                                                                            {({ data, error, loading }) => {\r\n                                                                                console.log(data)\r\n\r\n\r\n                                                                                return (\r\n                                                                                    <Query\r\n                                                                                        query={getAllSeriesOfACenterExamSessionQuery}\r\n                                                                                        variables={{ id: getObj && getObj.id }}>\r\n                                                                                        {({ data, loading, error }) => {\r\n                                                                                            { loading && <p>...Loading</p> }\r\n                                                                                            { error && <Error error={error} /> }\r\n                                                                                            console.log(data);\r\n\r\n                                                                                            const { centerExamSession } = data;\r\n\r\n                                                                                            const seriesCES = {\r\n                                                                                                ...centerExamSession\r\n                                                                                            };\r\n                                                                                            const { centerExamSessionSeries } = seriesCES;\r\n                                                                                            console.log(centerExamSessionSeries);\r\n                                                                                            // get all the series out of this object\r\n\r\n                                                                                            const newSeries = centerExamSessionSeries && centerExamSessionSeries.map((item) => (item.series))\r\n                                                                                            const refinedSeries = newSeries && newSeries.map(({\r\n                                                                                                __typename,\r\n                                                                                                seriesName,\r\n                                                                                                ...others\r\n                                                                                            }) => others);\r\n\r\n\r\n                                                                                            const seriesOptions = newSeries && newSeries.map((item) => (\r\n                                                                                                <option key={item.id} value={item.id}>\r\n                                                                                                    {item.seriesName}\r\n                                                                                                </option>\r\n                                                                                            ));\r\n\r\n                                                                                            return (\r\n\r\n                                                                                                <Query query={getCenterExamSessionSeriesQuery} variables={{\r\n                                                                                                    centerExamSession: getObj && getObj,\r\n                                                                                                    series: refinedSeries && getSelectedObject(refinedSeries, seriesID)\r\n                                                                                                }}   >\r\n                                                                                                    {({ data, error, loading }) => {\r\n                                                                                                        { loading && <p>...Loading</p> }\r\n                                                                                                        { error && <Error error={error} /> }\r\n                                                                                                        const { centerExamSessionSerieses } = { ...data }\r\n                                                                                                        const getCESS = centerExamSessionSerieses && centerExamSessionSerieses.reduce((item) => item)\r\n                                                                                                        console.log(getCESS)\r\n                                                                                                        console.log(refinedSeries)\r\n                                                                                                        const { id: idObj } = { ...getCESS }\r\n                                                                                                        const refinedCESS = idObj && this.makeCESSObject(idObj)\r\n                                                                                                        console.log(refinedCESS)\r\n                                                                                                        console.log(this.candRegistrationNumber(centerNumber, getExamName.examCode, getSessionName.sessionName, (99).pad(5))\r\n                                                                                                        )\r\n\r\n                                                                                                        return (\r\n                                                                                                            <Mutation\r\n                                                                                                                mutation={createRegistrationMutation}\r\n                                                                                                                variables={{\r\n                                                                                                                    ...this.state,\r\n                                                                                                                    candExamSecretCode: uniqueCodeGen(8),\r\n                                                                                                                    candidate: this.makeCandVariableObject(candCode),\r\n                                                                                                                    centerExamSession: getObj && getObj,\r\n                                                                                                                    series: refinedSeries && getSelectedObject(refinedSeries, seriesID),\r\n                                                                                                                    centerExamSessionSeries: refinedCESS && refinedCESS,\r\n                                                                                                                    candExamSession: candExamSessionCode(candCode, examID, sessionID),\r\n                                                                                                                    candRegistrationNumber: this.candRegistrationNumber(centerNumber, getExamName.examCode, getSessionName.sessionName, (10).pad(5))\r\n\r\n                                                                                                                }}>\r\n                                                                                                                {(createRegistration, { loading, error }) => (\r\n                                                                                                                    <MiniStyledPage >\r\n                                                                                                                        <Form\r\n                                                                                                                            method=\"POST\"\r\n                                                                                                                            onSubmit={async (e) => {\r\n                                                                                                                                e.preventDefault();\r\n                                                                                                                                const res = await createRegistration();\r\n                                                                                                                                console.log(res);\r\n                                                                                                                                this.resetForm();\r\n                                                                                                                                res && Router.push({\r\n                                                                                                                                    pathname: '/show/results/registrationReceipt',\r\n                                                                                                                                    query: { id: res.data.createRegistration.id },\r\n                                                                                                                                });\r\n                                                                                                                            }}>\r\n                                                                                                                            <h4>\r\n                                                                                                                                S'Inscrire à un Examen\r\n                                                                                                                                                    </h4>\r\n                                                                                                                            <Error error={error} />\r\n                                                                                                                            <fieldset disabled={loading} aria-busy={loading}>\r\n                                                                                                                                <StyledDivision >\r\n\r\n                                                                                                                                    <OtherSelect >\r\n                                                                                                                                        <input\r\n                                                                                                                                            type=\"textarea\"\r\n                                                                                                                                            id=\"centerName\"\r\n                                                                                                                                            name=\"centerName\"\r\n                                                                                                                                            placeholder=\"Nom du centre\"\r\n                                                                                                                                            value={centerByNumber && centerByNumber.centerCode}\r\n                                                                                                                                            rows=\"2\"\r\n                                                                                                                                            wrap=\"soft\"\r\n                                                                                                                                            readOnly\r\n                                                                                                                                        />\r\n                                                                                                                                        <input\r\n                                                                                                                                            type=\"number\"\r\n                                                                                                                                            id=\"centerNumber\"\r\n                                                                                                                                            name=\"centerNumber\"\r\n                                                                                                                                            placeholder=\"Numéro du centre\"\r\n                                                                                                                                            value={centerNumber}\r\n                                                                                                                                            onChange={this.handleChange}\r\n                                                                                                                                        />\r\n\r\n                                                                                                                                        <select\r\n                                                                                                                                            type=\"select\"\r\n                                                                                                                                            id=\"sessionID\"\r\n                                                                                                                                            name=\"sessionID\"\r\n                                                                                                                                            value={sessionID}\r\n                                                                                                                                            onChange={this.handleChange}\r\n                                                                                                                                            required>\r\n                                                                                                                                            <option >\r\n                                                                                                                                                La Session\r\n                                                                                                                                                                    </option>\r\n                                                                                                                                            {sessions && sessions.map((item) => (\r\n                                                                                                                                                <option key={item.id} value={item.id}>\r\n                                                                                                                                                    {item.sessionName}\r\n                                                                                                                                                </option>\r\n                                                                                                                                            ))}\r\n                                                                                                                                        </select>\r\n\r\n                                                                                                                                        <select\r\n                                                                                                                                            type=\"select\"\r\n                                                                                                                                            id=\"examID\"\r\n                                                                                                                                            name=\"examID\"\r\n                                                                                                                                            value={examID}\r\n                                                                                                                                            onChange={this.handleChange}\r\n                                                                                                                                            required>\r\n                                                                                                                                            <option >\r\n                                                                                                                                                L'Examen\r\n                                                                                                                                                                    </option>\r\n                                                                                                                                            {exams && exams.map((item) => (\r\n                                                                                                                                                <option key={item.id} value={item.id}>\r\n                                                                                                                                                    {item.examName}\r\n                                                                                                                                                </option>\r\n                                                                                                                                            ))}\r\n                                                                                                                                        </select>\r\n                                                                                                                                        <select\r\n                                                                                                                                            type=\"select\"\r\n                                                                                                                                            id=\"seriesID\"\r\n                                                                                                                                            name=\"seriesID\"\r\n                                                                                                                                            value={seriesID}\r\n                                                                                                                                            onChange={this.handleChange}\r\n                                                                                                                                            required>\r\n                                                                                                                                            <option >\r\n                                                                                                                                                La Série\r\n                                                                                                                                                                    </option>\r\n                                                                                                                                            {seriesOptions && seriesOptions}\r\n                                                                                                                                        </select>\r\n                                                                                                                                        <input\r\n                                                                                                                                            type=\"text\"\r\n                                                                                                                                            id=\"candCode\"\r\n                                                                                                                                            name=\"candCode\"\r\n                                                                                                                                            placeholder=\"Code Candidat\"\r\n                                                                                                                                            value={candCode}\r\n                                                                                                                                            onChange={this.handleChange}\r\n                                                                                                                                            required />\r\n\r\n                                                                                                                                        <div className=\"submitButton\">\r\n                                                                                                                                            <button type=\"submit\">\r\n                                                                                                                                                Valid{loading\r\n                                                                                                                                                    ? 'ation en cours'\r\n                                                                                                                                                    : 'er'}\r\n                                                                                                                                            </button>\r\n                                                                                                                                        </div>\r\n                                                                                                                                    </OtherSelect>\r\n                                                                                                                                </StyledDivision>\r\n                                                                                                                            </fieldset>\r\n                                                                                                                        </Form>\r\n                                                                                                                    </MiniStyledPage>\r\n                                                                                                                )\r\n                                                                                                                }\r\n                                                                                                            </Mutation>\r\n\r\n                                                                                                        )\r\n                                                                                                    }}\r\n                                                                                                </Query>\r\n                                                                                            )\r\n                                                                                        }}\r\n                                                                                    </Query>\r\n                                                                                );\r\n                                                                            }\r\n                                                                            }\r\n                                                                        </Query>\r\n                                                                    );\r\n                                                                }\r\n                                                                }\r\n                                                            </Query>\r\n                                                        );\r\n                                                    }\r\n                                                    }\r\n                                                </Query>\r\n                                            );\r\n                                        }\r\n                                        }\r\n                                    </Query>\r\n                                );\r\n                            }\r\n                            }\r\n                        </Query>\r\n                    );\r\n                }\r\n                }\r\n            </Query>\r\n\r\n        );\r\n    }\r\n}\r\n\r\nexport default RecentRegistration;\r\n"],"mappings":"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","sourceRoot":""}